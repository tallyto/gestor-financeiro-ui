<div class="notificacoes-container">
  <div class="header">
    <div class="header-content">
      <mat-icon class="header-icon">notifications</mat-icon>
      <div class="header-text">
        <h2>Notificações</h2>
      </div>
    </div>
    <div class="header-actions">
      <button mat-stroked-button color="primary" (click)="carregarNotificacoes()" class="refresh-button">
        <mat-icon>refresh</mat-icon>
        <span>Atualizar</span>
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <mat-card class="filtros-card">
    <mat-card-header>
      <mat-icon mat-card-avatar class="filtro-header-icon">filter_alt</mat-icon>
      <mat-card-title>Filtros</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-chip-set aria-label="Filtros de notificação" class="filtro-chips">
        <mat-chip-option
          *ngFor="let filtro of filtros"
          [selected]="filtroAtual === filtro.valor"
          [class]="'filtro-' + filtro.valor.toLowerCase()"
          (click)="aplicarFiltro(filtro.valor)">
          <div class="chip-content">
            <mat-icon class="filtro-icon">{{ getIconeFiltro(filtro.valor) }}</mat-icon>
            <span>{{ filtro.label }}</span>
            <span class="contador-chip" *ngIf="getContadorPorFiltro(filtro.valor) > 0">{{ getContadorPorFiltro(filtro.valor) }}</span>
          </div>
        </mat-chip-option>
      </mat-chip-set>
    </mat-card-content>
  </mat-card>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-card">
      <mat-spinner diameter="30"></mat-spinner>
      <div class="loading-text">
        <h3>Carregando</h3>
      </div>
    </div>
  </div>

  <!-- Lista de Notificações -->
  <div *ngIf="!loading" class="notificacoes-lista">
    <!-- Estado vazio -->
    <div *ngIf="filtrarNotificacoes().length === 0" class="empty-state">
      <div class="empty-state-content">
        <mat-icon class="empty-icon">notifications_off</mat-icon>
        <h3>Nenhuma notificação</h3>
        <p *ngIf="filtroAtual === 'TODAS'">Você não possui notificações pendentes.</p>
        <p *ngIf="filtroAtual !== 'TODAS'">Nenhuma notificação do tipo "{{ getFiltroLabel(filtroAtual) }}".</p>
        <button mat-stroked-button color="primary" (click)="aplicarFiltro('TODAS')" *ngIf="filtroAtual !== 'TODAS'">
          Ver todas
        </button>
      </div>
    </div>

    <!-- Notificações -->
    <mat-card *ngFor="let notificacao of filtrarNotificacoes()"
              class="notificacao-card"
              [class]="'prioridade-' + notificacao.prioridade.toLowerCase()"
              (click)="navegarParaEntidade(notificacao)">

      <div class="notificacao-content">
        <!-- Ícone e Prioridade -->
        <div class="notificacao-icon" [style.background-color]="getBackgroundColor(notificacao.prioridade)">
          <mat-icon [style.color]="getIconColor(notificacao.prioridade)">
            {{ getIconeTipo(notificacao.tipo) }}
          </mat-icon>
        </div>

        <!-- Conteúdo Principal -->
        <div class="notificacao-info">
          <div class="notificacao-header">
            <h4>{{ notificacao.titulo }}</h4>
            <mat-chip class="prioridade-chip"
                     [style.background-color]="getCorPrioridade(notificacao.prioridade)"
                     [style.color]="'white'">
              {{ getPrioridadeLabel(notificacao.prioridade) }}
            </mat-chip>
          </div>

          <p class="notificacao-mensagem">{{ notificacao.mensagem }}</p>

          <div class="notificacao-footer">
            <div class="tempo-info" [class.atrasado]="notificacao.tipo.includes('ATRASADA')">
              <mat-icon class="tempo-icon">
                {{ notificacao.tipo.includes('ATRASADA') ? 'event_busy' : 'event_available' }}
              </mat-icon>
              <span>{{ formatarDias(notificacao.diasDiferenca, notificacao.tipo) }}</span>
            </div>
            <div class="tipo-entidade">
              <mat-icon class="entity-icon">
                {{ notificacao.tipoEntidade === 'CONTA_FIXA' ? 'account_balance' : 'credit_card' }}
              </mat-icon>
              <span>{{ notificacao.tipoEntidade === 'CONTA_FIXA' ? 'Conta' : 'Fatura' }}</span>
            </div>
          </div>
        </div>

        <!-- Seta para navegação -->
        <div class="notificacao-arrow">
          <mat-icon>chevron_right</mat-icon>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Resumo Estatísticas -->
  <mat-card *ngIf="!loading && notificacoes.length > 0" class="estatisticas-card">
    <mat-card-header>
      <mat-icon mat-card-avatar>insights</mat-icon>
      <mat-card-title>Resumo de Notificações</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="estatisticas-grid">
        <div class="stat-item total">
          <mat-icon class="stat-icon">notifications</mat-icon>
          <div class="stat-content">
            <div class="stat-number">{{ notificacoes.length }}</div>
            <div class="stat-label">Total de Notificações</div>
          </div>
        </div>
        
        <div class="stat-item alta">
          <mat-icon class="stat-icon">warning</mat-icon>
          <div class="stat-content">
            <div class="stat-number">{{ getNotificacoesPrioridade() }}</div>
            <div class="stat-label">Alta/Crítica Prioridade</div>
          </div>
        </div>
        
        <div class="stat-item atrasadas">
          <mat-icon class="stat-icon">schedule</mat-icon>
          <div class="stat-content">
            <div class="stat-number">{{ getNotificacoesAtrasadas() }}</div>
            <div class="stat-label">Em Atraso</div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
